<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="path/to/chartjs/dist/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="../css/dashboard.css">
    <title>DashBoard</title>
</head>
<body>
    <div class="container">
        <div class="dashboard">
            <div class="grafico-esquerda">
                <div class="kpi">
                    <div class="box-kpi" id="kpi1">
                        <div class="titulo" style="background-color: #70A9A1;">
                            <h2>Categoria mais escolhida</h2>
                        </div>
                        <div class="kpi-num" style="background-color: #70A9A1;">
                            5.872
                        </div>
                        <div class="kpi-sub-texto" style="background-color: #70A9A1;">
                        </div>
                    </div>
                    <div class="box-kpi" id="kpi2">
                        <div class="titulo" style="background-color: #E08E37;">
                            <h2>Região com mais cadastros</h2>
                        </div>
                        <div class="kpi-num" style="background-color: #E08E37;">
                            5.872
                        </div>
                        <div class="kpi-sub-texto" style="background-color: #E08E37;">
                        </div>
                    </div>
                    <div class="box-kpi" id="kpi3">
                        <div class="titulo" style="background-color: #515B3A;">
                            <h2>Quantidade de receitas cadastradas</h2>
                        </div>
                        <div class="kpi-num" style="background-color: #515B3A;">
                            5.872
                        </div>
                        <div class="kpi-sub-texto" style="background-color: #515B3A;">
                        </div>
                    </div>
                </div>
                <div class="grafico">
                    <div id="grafico-geral">
                        <h2>Quantidade de receitas por categoria</h2>
                        <canvas id="myChart-grafico" style="width: 3px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="side">
            <div class="user">
                <div class="line">
                    <div class="foto"><img src="../assets/imgs/chef.webp"></div>
                    <h3>Olá, Bem vindo</h3>
                </div>
            </div>
            <div class="box">
                <div class="menu">
                    <div style="background-color: #E08E37;cursor: pointer;">Dashboard</div>
                    <div onclick="receitas()" style="cursor: pointer;">Cadastrar receitas</div>
                </div>
                <div class="sair">
                    <div>
                        <h2><a href="./index.html"><span>SAIR</span></a></h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

 <!-- script JS de connfiguração do chartJS -->
<script>

function receitas(){
    window.location.href = 'cadastrar_receita.html';
}

    document.getElementById("grafico-geral").innerHTML = plotarDadosDoGrafico();

    function plotarkpi1 (){
            fetch('/plotarkpi1')
        .then((response) => response.json())
        .then((dados) => {
            console.log(dados);
            document.getElementById('categoria-destaque').innerText = dados[0].categoria;
            document.getElementById('quantidade').innerText = dados[0].quantidade;
        })
        .catch((erro) => {
            console.error("Erro ao buscar dados:", erro);
        });
    }

    function plotarkpi2 (){
            fetch('/plotarkpi2')
        .then((response) => response.json())
        .then((dados) => {
            console.log(dados);
            document.getElementById('regiao-destaque').innerText = dados[0].regiao;
        })
        .catch((erro) => {
            console.error("Erro ao buscar dados:", erro);
    });
    }

    function plotarkpi3 (){
            fetch('/plotarkpi3')
        .then((response) => response.json())
        .then((dados) => {
            console.log(dados);
            document.getElementById('quantidade-receitas').innerText = dados[0].quantidadereceitas;
        })
        .catch((erro) => {
            console.error("Erro ao buscar dados:", erro);
    });
    }

    function plotarDadosDoGrafico() {
    fetch('/plotarDadosDoGrafico')
        .then((response) => response.json())
        .then((dados) => {
            // Criando arrays separados para categoria e quantidade
            let categorias = [];
            let quantidades = [];
            
            dados.forEach((item) => {
                categorias.push(item.categoria);  // Nome da categoria
                quantidades.push(item.quantidade);  // Quantidade
            });
            
            // Exibindo os arrays no console (para verificar se estão corretos)
            console.log("Categorias:", categorias);
            console.log("Quantidades:", quantidades);

            // Criando gráfico com os dados coletados
            let ctx = document.getElementById('myChart-grafico').getContext('2d');  // Correção do id
            let myChart = new Chart(ctx, {
                type: 'bar',  // Tipo do gráfico (pode ser 'bar', 'line', etc.)
                data: {
                    labels: categorias,  // As categorias (eixo X)
                    datasets: [{
                        label: 'Quantidade de Categorias',
                        data: quantidades,  // As quantidades (eixo Y)
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',  // Cor das barras
                        borderColor: 'rgba(255, 99, 132, 1)',  // Cor da borda das barras
                        borderWidth: 1
                    }]
                }
            });
        })
        .catch((erro) => {
            console.error("Erro ao buscar dados:", erro);
        });
}
</script>